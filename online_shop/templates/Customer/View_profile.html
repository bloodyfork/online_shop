{% extends 'core/main.html' %}
{% load static %}

{% block content %}

{#    {% for message in messages %}#}
{#        <div style="background-color: gray" class=" sticky rounded mt-5 p-1 centered">#}
{#            <h6 style="color: snow; ">{{ message }}</h6>#}
{#        </div>#}
{#    {% endfor %}#}
    <div class="row">

    <div class="box-element product col-lg-8">
        <div class="col-lg-12 product centered">
            <h1><strong>Recent Orders</strong></h1>
        </div>
        <br>
        <br>
        <br>
        <h6 style=""> .................................................................................................................</h6>
    </div>

    <div class="box-element product col-lg-4">

        <div class="box-element">

                 <a href="{% url 'logout' %} " class="btn btn-danger" style="margin-right: 10px; color: whitesmoke;  float: right">Logout</a>

            <br>
            <br>
            <h4 style=""><b>Username:</b>  {{user.username}}</h4>
            <br>
            <h4 style=""><b>Phone Number:</b>  {{user.phone}}</h4>

            <br>

            <button class="centered btn btn-outline-dark col-lg-10">change Password</button>


        </div>
    </div>
</div>






<div class="box-element mt-2 col-lg-12">
            {% for A in addresses %}
                <div id="address{{ A.id }}"  class="box-element mt-2 AddressBar">
                    <div class="cart-row">

                        <div style="flex:3"><strong>Province</strong></div>
                        <div style="flex:2"><strong>City</strong></div>
                        <div style="flex:5"><strong>Zip-Code</strong></div>

                    </div>

                    <div class="cart-row">

                        <div class="showing-province" style="flex:3">{{ A.province }}</div>
                        <div class="mr-3 showing-city" style="flex:2">{{A.city}}</div>
                        <div class="mr-4 showing-zip" style="flex:3">{{ A.postal_code }}</div>


                        <button type="button" class="centered btn btn-info col-lg-1 mr-1" data-toggle="modal" data-target="#exampleModalCenter">Edit</button>
                        <button  onclick="DeleteAddress({{ A.id }})" class="centered btn btn-danger col-lg-1">Delete</button>
                    </div>

                </div>

            {% endfor %}
    <!-- The Modal -->
        <div id="myModal" class="modal  mt-5 col-lg-12" >

        <!-- Modal content -->
        <div class="modal-content">
            <span class="close">&times;</span>
            <form>

                    <label for="Province">Province:</label>
                    <input style="flex:1" type="text" id="Province" >



                    <label for="City">City:</label>
                    <input style="flex:1" type="text" id="City">



                    <label for="Exact">Exact Address:</label>
                    <input style="flex:1" type="text" id="Exact" >



                    <label for="Zip">Postal Code:</label>
                    <input style="flex:1" type="number" id="Zip">

                <input class="btn btn-success" onclick="CreateAddress()" type="submit" value="Submit">
            </form>
        </div>
</div>


<!-- Modal -->
<div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLongTitle">Edit Address</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form>

            <label for="P">Province:</label><br>
            <input style="flex:1" type="text" id="P" ><br>



            <label for="C">City:</label><br>
            <input style="flex:1" type="text" id="C"><br>



            <label for="E">Exact Address:</label><br>
            <input style="flex:1" type="text" id="E" ><br>



            <label for="Z">Postal Code:</label><br>
            <input style="flex:1" type="number" id="Z"><br>

            <div class="modal-footer">
                <input class="btn btn-success" onclick="UpdateAddress({{ A.id }})" type="submit" value="Submit">
            </div>
        </form>

      </div>

    </div>
  </div>
</div>

         <button id="myBtn" class="centered btn btn-info col-lg-12">Add Address</button>

</div>

     <script>
    function CreateAddress(){
         let province = $('#Province').val()
         let city = $('#City').val()
         let exact = $('#Exact').val()
         let zip = $('#Zip').val()

        $.ajax({
            url: "{% url 'CreateAddress' %}",
            method: 'POST',
            headers: {
                'X-CSRFToken': '{{ csrf_token }}'
            },
            data: {
                'province': province,
                'city': city,
                'zip': zip,
                'exact_address': exact,
            },

            success: function () {


            },
        })

    }
    </script>


    <script>

    function DeleteAddress(value){

        $.ajax({
            url: "{% url 'DeleteAddress' pk=0 %}".replace(/0/, value),
            method: 'DELETE',
            headers: {
                'X-CSRFToken': '{{ csrf_token }}'
            },

            success: function () {
                 let x = document.getElementById(`address${value}`)
                 x.remove()

            },
        })
    }
    </script>

         <script>

            function UpdateAddress(value){
                {#let province = $('#P').val()#}
                {#let city = $('#C').val()#}
                {#let exact = $('#E').val()#}
                {#let zip = $('#Z').val()#}

                $.ajax({
                    url: "{% url 'UpdateAddress' pk=0 %}".replace(/0/, value),
                    method: 'PATCH',
                    headers: {
                        'X-CSRFToken': '{{ csrf_token }}'
                 },
                    data: {
                        'province': province,
                        'city': city,
                        'zip': zip,
                        'exact_address': exact,
                    },

                    success: function () {


                    },
                })

            }
    </script>

    <script>
        // Get the modal
        var modal = document.getElementById("myModal");

// Get the button that opens the modal
        var btn = document.getElementById("myBtn");

// Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];

// When the user clicks on the button, open the modal
        btn.onclick = function() {
        modal.style.display = "block";
        }

// When the user clicks on <span> (x), close the modal
        span.onclick = function() {
        modal.style.display = "none";
        }

// When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
        }
    </script>




{% endblock %}
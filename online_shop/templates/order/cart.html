{% extends 'core/main.html' %}
{% load static %}

{% block content %}
    <div class="row">
        <div class="col-lg-12">
            <div class="box-element">
                <a href="{% url 'store' %}" class="btn btn-outline-dark">&#x2190 Back to Store</a>
                <div style="float: right">
                    <label for="OffCode" style="color: #4D4D4DFF">Got Off Code?</label>
                    <input class="rounded box-element" id="OffCode" type="text">
                    <input class="btn btn-outline-success" id="OffCode-submit" type="submit">
                </div>

                <br>
                <br>

                <table class="table">
                    <tr>
                        <th><h5>Items: <strong>{{ cart.total_count }}</strong></h5></th>
                        <th><h5>Total price: <strong>${{ cart.calculate_total_price }}</strong></h5></th>
                        <th><h5>Final price: <strong>${{ cart.calculate_final_price }}</strong></h5></th>
                        <th>
                            <a style="float: right; margin: 5px" class="btn btn-success" href="#">Checkout</a>
                        </th>
                    </tr>
                </table>

            </div>
            <br>
            {% for item in items %}
                <div class="box-element mt-3">
                    <div class="cart-row">
                        <div style="flex:2"></div>
                        <div style="flex:2"><strong>Item</strong></div>
                        <div style="flex:1"><strong>Price</strong></div>
                        <div style="flex:1"><strong>Quantity</strong></div>
                        <div style="flex:1"><strong>Total</strong></div>
                    </div>

                    <div class="cart-row">
                        <div style="flex:2">
                            <image src="{{ item.product.image.url }}" class="row-image"></image>
                        </div>
                        <div style="flex:2">{{ item.product.name }}</div>
                        <div style="flex:1">${{ item.product.price| floatformat }}</div>
                        <div style="flex:1">
                            <p class="count-of-item" id="how_many">{{ item.how_many }}</p>
                            <div class="count-of-item">
                                <button value="{{ item.id }}" class=" btn btn-outline-secondary" data-action=""  id="up" onclick="Increaser(this.value)"><i
                                        class="fa fa-angle-up" style="font-size:24px"></i></button>
                                <button value="{{ item.id }}" class=" btn btn-outline-secondary " id="down" onclick="Decreaser(this.value)"><i
                                        class="fa fa-angle-down" style="font-size:24px"></i></button>
                            </div>
                        </div>
                        <div style="flex:1">${{ item.sum_of_prices_after_discount }}</div>
                    </div>

                </div>
            {% endfor %}
        </div>
    </div>

    <script>
    function Increaser(value){

        $.ajax({
            url: "{% url 'IncAndDec' pk=12345 %}".replace(/12345/, value),
            method: 'PATCH',
            headers: {
                'X-CSRFTOKEN': '{{ csrf_token }}'
            },
            data: {
                'how_many' : Number($('#how_many')),
                'item_id' : value
            },
            success: function (success) {
                {#$(`#order_item_price_${id}`).html(success.formatted_price)#}
                {#$('#order_items_final_price').html(success.final_prices_sum)#}
            },
        })

    }



    </script>

{% endblock %}